window.setTimeout(function(){(!(window.fbAsyncInit&&window.fbAsyncInit.hasRun&&window.cnvAsyncInit)||window.cnvAsyncInit.hasRun)&&(window.fbAsyncInit||!window.cnvAsyncInit||window.cnvAsyncInit.hasRun)||(window.cnvAsyncInit.hasRun=!0,window.cnvAsyncInit())},0),window.Cnv=window.Cnv||{},function($,JSON){function buildParams(e,t,n){if("[object Array]"===Object.prototype.toString.call(t))for(var a=0,o=t.length;a<o;a++)rbracket.test(e)?n(e,t[a]):buildParams(e+"["+("object"==typeof t[a]?a:"")+"]",t[a],n);else if("object"==typeof t)for(var r in t)buildParams(e+"["+r+"]",t[r],n);else n(e,t)}var rbracket,r20;void 0===$&&(rbracket=/\[\]$/,r20=/%20/g,$={param:function(e){function t(e,t){t=null==t?"":t,a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)}var n,a=[];if("[object Array]"===Object.prototype.toString.call(e))for(var o=0,r=e.length;o<r;o++)t(e[o].name,e[o].value);else for(n in e)buildParams(n,e[n],t);return a.join("&").replace(r20,"+")}}),JSON||(JSON={},function(){function f(e){return e<10?"0"+e:e}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,a,o,r,i,s=gap,c=t[e];switch(c&&"object"==typeof c&&"[object Date]"===Object.prototype.toString.apply(c)&&(c=this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;n<r;n+=1)i[n]=str(n,c)||"null";return o=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+s+"]":"["+i.join(",")+"]",gap=s,o}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;n<r;n+=1)"string"==typeof(a=rep[n])&&(o=str(a,c))&&i.push(quote(a)+(gap?": ":":")+o);else for(a in c)Object.hasOwnProperty.call(c,a)&&(o=str(a,c))&&i.push(quote(a)+(gap?": ":":")+o);return o=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+s+"}":"{"+i.join(",")+"}",gap=s,o}}JSON.stringify=function(e,t,n){var a;if(indent=gap="","number"==typeof n)for(a=0;a<n;a+=1)indent+=" ";else"string"==typeof n&&(indent=n);if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var n,a,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.hasOwnProperty.call(o,n)&&(void 0!==(a=walk(o,n))?o[n]=a:delete o[n]);return reviver.call(e,t,o)}if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}());var pm={poll:200,send:function(e){var t={target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1};for(k in e)t[k]=e[k];var n,a=t.target;t.target&&t.type&&(n={data:t.data,type:t.type},t.success&&(n.callback=pm._callback(t.success)),t.error&&(n.errback=pm._callback(t.error)),"postMessage"in a&&!t.hash?(pm._bind(),a.postMessage(JSON.stringify(n),t.origin||"*")):(pm.hash._bind(),pm.hash.send(t,n)))},bind:function(e,t,n,a){pm._replyBind(e,t,n,a,!0)},_replyBind:function(e,t,n,a,o){("postMessage"in window&&!a?pm:pm.hash)._bind();var r=pm.data("listeners.postmessage");r||(r={},pm.data("listeners.postmessage",r));a=r[e];a||(a=[],r[e]=a),a.push({fn:t,callback:o,origin:n||"*"})},unbind:function(e,t){var n=pm.data("listeners.postmessage");if(n)if(e)if(t){var a=n[e];if(a){for(var o=[],r=0,i=a.length;r<i;r++){var s=a[r];s.fn!==t&&o.push(s)}n[e]=o}}else delete n[e];else for(var r in n)delete n[r]},data:function(e,t){return void 0===t?pm._data[e]:pm._data[e]=t},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var e=[],t=0;t<32;t++)e[t]=pm._CHARS[0|32*Math.random()];return e.join("")},_callback:function(e){var t=pm.data("callbacks.postmessage");t||(t={},pm.data("callbacks.postmessage",t));var n=pm._random();return t[n]=e,n},_bind:function(){pm.data("listening.postmessage")||(window.addEventListener?window.addEventListener("message",pm._dispatch,!1):window.attachEvent&&window.attachEvent("onmessage",pm._dispatch),pm.data("listening.postmessage",1))},_dispatch:function(t){try{if(-1!=t.origin.indexOf("fbcdn.net"))return;var n=JSON.parse(t.data)}catch(e){}if(n.type){var e=(pm.data("callbacks.postmessage")||{})[n.type];if(e)e(n.data);else for(var a=(pm.data("listeners.postmessage")||{})[n.type]||[],o=0,r=a.length;o<r;o++){var i,s=a[o];if(s.origin&&"*"!==s.origin&&t.origin!==s.origin)n.errback&&(i={message:"postmessage origin mismatch",origin:[t.origin,s.origin]},pm.send({target:t.source,data:i,type:n.errback}));else try{s.callback?s.fn(n.data,c,t):c(s.fn(n.data,t))}catch(e){if(!n.errback)throw e;pm.send({target:t.source,data:e,type:n.errback})}function c(e){n.callback&&pm.send({target:t.source,data:e,type:n.callback})}}}},hash:{send:function(e,t){var n=e.target,a=e.url;if(a){a=pm.hash._url(a);var o,e=pm.hash._url(window.location.href);if(window==n.parent)o="parent";else try{for(var r=0,i=parent.frames.length;r<i;r++)if(parent.frames[r]==window){o=r;break}}catch(e){o=window.name}null!=o&&(e={"x-requested-with":"postmessage",source:{name:o,url:e},postmessage:t},t="#x-postmessage-id="+pm._random(),n.location=a+t+encodeURIComponent(JSON.stringify(e)))}},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:"#x-postmessage-id=".length+32,_bind:function(){pm.data("polling.postmessage")||(setInterval(function(){var e=""+window.location.hash,t=pm.hash._regex.exec(e);t&&(t=t[1],pm.hash._last!==t&&(pm.hash._last=t,pm.hash._dispatch(e.substring(pm.hash._regex_len))))},$.pm.poll||200),pm.data("polling.postmessage",1))},_dispatch:function(t){if(t){try{if(!("postmessage"===(t=JSON.parse(decodeURIComponent(t)))["x-requested-with"]&&t.source&&null!=t.source.name&&t.source.url&&t.postmessage))return}catch(e){return}var n=t.postmessage,e=(pm.data("callbacks.postmessage")||{})[n.type];if(e)e(n.data);else for(var a="parent"===t.source.name?window.parent:window.frames[t.source.name],o=(pm.data("listeners.postmessage")||{})[n.type]||[],r=0,i=o.length;r<i;r++){var s=o[r];if(s.origin){var c=/https?\:\/\/[^\/]*/.exec(t.source.url)[0];if("*"!==s.origin&&c!==s.origin){n.errback&&(c={message:"postmessage origin mismatch",origin:[c,s.origin]},pm.send({target:a,data:c,type:n.errback,hash:!0,url:t.source.url}));continue}}function d(e){n.callback&&pm.send({target:a,data:e,type:n.callback,hash:!0,url:t.source.url})}try{s.callback?s.fn(n.data,d):d(s.fn(n.data))}catch(e){if(!n.errback)throw e;pm.send({target:a,data:e,type:n.errback,hash:!0,url:t.source.url})}}}},_url:function(e){return(""+e).replace(/#.*$/,"")}}},restLink,debug,eventPageLoaded=!1,reservedParams=["cr","cn","ct","mg","et","pk","tp","sn","ap","ak_guid","wegc","pi"],renderContentSuccessCallbacks=[],renderContentErrorCallbacks=[],preLoadEventQueue=[],protocol=document.location.protocol,cookie={data:{},load:function(e){for(var t=document.cookie.split(";"),n=!1,a=0;a<t.length;a++){var o=t[a].substr(0,t[a].indexOf("=")),r=t[a].substr(t[a].indexOf("=")+1),o=o.replace(" ",""),r=r.replace(" ","");o===e&&(data=QueryStringToJSON(r),n=!0)}return!!n&&data},save:function(e,t,n){var a=new Date;a.setDate(a.getDate()+3650);var o=void 0===t?a:t,a=n||"/",t=decodeURIComponent($.param(this.data)),n=getSecondLevelDomain(window.location.host);document.cookie=e+"="+t+";path="+a+";expires="+o.toGMTString()+";domain=."+n}};Cnv.PostWebEvent=function(e,t,n){var a={};a.pm=e,a.rp=cookie.data,a.rp.we=t,postToConversen(a,"wts/WebEvent",n)},Cnv.RenderContent=function(t){var n;t.data=t.data||null,t.success=t.success||function(){},t.error=t.error||function(){},eventPageLoaded?(n=guidGenerator(),t.data.GuidId=n,t.data.CustId=cookie.data.cr,pm.send({target:window.frames.cnvIframe,type:"SdkEventListener",data:t.data,error:function(e){t.error("error communicating with cnv, please try again or contact support")},success:function(e){renderContentSuccessCallbacks[n]=t.success,renderContentErrorCallbacks[n]=t.error}})):preLoadEventQueue.push(t)},Cnv.Log=function(e,t){var n;!0===debug&&(a=(n=document.getElementById("cnv-log")).text(),a+=e.toString(),n.html(a));var a={};a.Log=e,url=void 0===t?"sts/Log":t+"/Log",postToConversen(a,url,null)},Cnv.init=function(t){try{conversenInit(restLink=protocol+"//"+t.restLink+"/",t),t.success&&t.success()}catch(e){t.error(e)}};var previousCookie,cookieDomain="";function conversenInit(e,t){var n=new Date,a=new Date(n.getTime()+6048e5),o="xyz_cr_"+t.custId+"_et_"+t.entityId,r=fetchCnvParams();void 0!==r.tp&&"j"===r.tp.substr(0,1)&&(o="xyz_cr_"+t.custId,cookie.data.et=void 0,t.entityId=void 0);n=null;void 0!==window.FB&&(n=window.FB._apiKey),cookieDomain=t.cookieDomain,(previousCookie=cookie.load(o))||(cookie.save(o,a,"/"),previousCookie=cookie.load(o)),updateCnvCookie(previousCookie,r),cookie.data.cr=void 0===t.custId?cookie.data.cr:t.custId,cookie.data.wegc=void 0===t.webEventGroupCode?null:t.webEventGroupCode,void 0===t.entityId&&void 0===cookie.data.et||(cookie.data.et=void 0===t.entityId?cookie.data.et:t.entityId),cookie.data.ap=n,getCookieExpiryAsync(e,t.custId,o,a),debug=t.debug;t.params;void 0!==t.enableSocialEvents&&!t.enableSocialEvents||((a=document.createElement("iframe")).name="cnvIframe",a.id="cnvIframe",a.src=e+"sts/SocialEvent/Event",a.style="display:none;",document.body.appendChild(a),pm.bind("CnvEventListener",function(e){var t;e.errorData?(t=renderContentErrorCallbacks[e.GuidId])&&t(e.errorData):e.successData&&(0,renderContentSuccessCallbacks[e.GuidId])(e.successData),renderContentSuccessCallbacks[e.GuidId]=null,renderContentErrorCallbacks[e.GuidId]=null}),pm.bind("FinishedLoading",function(e){if(e){eventPageLoaded=e;for(var t=0,n=preLoadEventQueue;t<n;t++){var a=preLoadEventQueue[t];Cnv.RenderContent(a)}preLoadEventQueue=null}})),t.enableFacebook&&(isNaN(cookie.data.ap)||isNaN(cookie.data.cr)||isNaN(cookie.data.et)?Cnv.Log("Failed to initialize Conversen.FB.init","sts"):(window.FB.Event.subscribe("auth.login",conversenAuthLogin),window.FB.Event.subscribe("auth.logout",conversenAuthLogout),window.FB.Event.subscribe("edge.create",conversenEdgeCreate),window.FB.Event.subscribe("comment.create",conversenCommentCreate),window.FB.Event.subscribe("message.send",conversenMessageSend),window.FB.Event.subscribe("fb.log",Cnv.Log)))}function conversenAuthLogin(e){var t={};t.au=e,t.rp=cookie.data,postJsonToConversen(t,"sts/AuthLogin",null),window.FB.api("/me",function(a){window.FB.api("/me/likes",function(e){var t={},n={};n.me=a,n.likes=e,t.pf=n,t.rp=cookie.data;n="sts-profile-"+n.me.id;0==cookie.load(n)&&(cookie.data={postedProfile:"true"},cookie.save(n),postJsonToConversen(t,"sts/Profile",null)),cookie.data=t.rp})})}function conversenMessageSend(e){var t={};t.rp=cookie.data,t.href=e,postJsonToConversen(t,"sts/MessageSend",null)}function conversenEdgeCreate(e){var t={};t.rp=cookie.data,t.href=e,postJsonToConversen(t,"sts/EdgeCreate",null)}function conversenCommentCreate(e){var t=e.commentID,n=e.href;window.FB.Data.query('SELECT comments_fbid FROM link_stat WHERE url="{0}"',e.href).wait(function(e){window.FB.Data.query("SELECT xid,object_id,post_id,fromid,time,text,id,username,reply_xid,post_fbid,likes,user_likes FROM comment WHERE object_id={0} AND post_fbid={1}",e[0].comments_fbid,t).wait(function(e){var t={};t.cc=e[0],t.cc.href=n,t.rp=cookie.data,postJsonToConversen(t,"sts/CommentCreate",null);e="/"+e[0].fromid;window.FB.api(e,function(e){var t={},n={};n.me=e,t.pf=n,t.rp=cookie.data,postJsonToConversen(t,"sts/Profile",null)})},function(e){Cnv.Log(e)})},function(e){Cnv.Log(e)})}function postToConversen(e,t,n){!0===debug&&(document.getElementById("cnv-log").innerHTML+="<br />"+o);var a=guidGenerator(),o=decodeURIComponent($.param(e)),e=restLink+t+"/image.gif?";1900<=e.length+o.length?splitPostRequest(e,t,o,a):imagePost(e=e+"isSplit=false&guid="+a+"&segmentNumber=1&",o)}function postJsonToConversen(t,n,a){t.mt=n,pm.send({target:window.frames.cnvIframe,type:"CnvEvent",data:t,error:function(e){postToConversen(t,n,a)}})}function imagePost(e,t){var n=document.createElement("img");n.style.display="none",n.src=e+t,document.body.appendChild(n),document.body.removeChild(n)}function splitPostRequest(e,t,n,a){for(var o,r,i=e.length,s=[],c=1;1900<i+n.length;)o=n.lastIndexOf("&",1600),r=n.substring(0,o),n=n.substring(o+1),s.push("isSplit=true&guid="+a+"&segmentNumber="+c+"&"+r+"&"),c++;for(s.push("isSplit=true&guid="+a+"&segmentNumber="+c+"&"+n+"&"),imagePost(restLink+t+"/header.gif?","guid="+a+"&numberOfSegments="+c);0<s.length;)imagePost(e,s.pop())}function guidGenerator(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function updateCnvCookie(e,t){!1!==t?void 0===t.tp?cookie.data=t:(cookie.data={},cookie.data.tp=t.tp,void 0!==t.pi&&(cookie.data.pi=t.pi)):cookie.data=e}function fetchCnvParams(){function e(e){return decodeURIComponent(e.replace(r," "))}for(var t,n={},a={},o=!1,r=/\+/g,i=/([^&=]+)=?([^&]*)/g,s=window.location.search.substring(1);t=i.exec(s);)n[e(t[1])]=e(t[2]);for(var c=0;c<reservedParams.length;c++){var d=reservedParams[c];void 0!==n[d]&&(a[d]=n[d],o=!0)}return!!o&&a}function loadScript(e,t){var n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.src=e;var o=!1;a.onload=a.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,t(),a.onload=a.onreadystatechange=null,n.removeChild(a))},n.appendChild(a)}function QueryStringToJSON(e){var t=e.replace(/(.*?\?)/,"").split("&");stack={};for(var n=0,a=t.length;n<a;n++){var o=t[n].split("="),r=o[0],i=isNaN(o[1])?o[1]:parseFloat(o[1]);r.match(/(.*?)\[(.*?)]/)?(r=RegExp.$1,o=RegExp.$2,"tp"===r&&isNaN(i)||(o?(r in stack||(stack[r]={}),stack[r][o]=i):(r in stack||(stack[r]=[]),stack[r].push(i)))):stack[r]=i}return stack}function getSecondLevelDomain(e){if(cookieDomain)return cookieDomain;var t=e.split("."),n=t.length,e=0;return 2!==t[n-1].length||"co"!==t[n-2]&&"com"!==t[n-2]||e++,t.slice(n-e-2,n).join(".")}function getCookieExpiryAsync(e,t,n,a){var o,r=new Date;try{var i=new XMLHttpRequest;i.open("GET",e+"wts/WebEvent/GetCookieExpiry/"+t,!0),i.timeout=5e3,i.onreadystatechange=function(){var e;4===this.readyState&&(200===this.status?(e=i.responseXML.getElementsByTagName("cookieExpiry")[0].firstChild.nodeValue,o=e<0?a:(e=1e3*e,new Date(r.getTime()+e))):0===this.status&&(o=a),cookie.save(n,o,"/"))},i.send()}catch(e){cookie.save(n,a,"/")}}}(window.jQuery,window.JSON);